name: Shorebird Workflow

on:
  push:
    branches: [main]

jobs:
  patch-application:
    defaults:
      run:
        shell: bash
    runs-on: ubuntu-latest

    steps:
      - name: 🐦 Setup Shorebird
        uses: shorebirdtech/setup-shorebird@v0
      - name: 🚀 Use Shorebird
        run: shorebird --version

      - name: 🚀 Check Application
        run: shorebird apps list
        env:
          SHOREBIRD_TOKEN: ${{ secrets.SHOREBIRD_TOKEN }}
      - name: Build Flutter (Android)
        run: |
          git clone https://github.com/flutter/flutter.git -b stable
          export PATH="$PWD/flutter/bin:$PATH"
          flutter doctor
      # for testing purposes
      - name: 🚀 Shorebird doctor
        run: shorebird doctor --fix
        env:
          SHOREBIRD_TOKEN: ${{ secrets.SHOREBIRD_TOKEN }}

      - name: 🚀 Shorebird Patch
        run: shorebird patch android --force
        env:
          SHOREBIRD_TOKEN: ${{ secrets.SHOREBIRD_TOKEN }}